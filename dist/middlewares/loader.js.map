{"version":3,"sources":["../../src/middlewares/loader.ts"],"sourcesContent":["import DataLoader from 'dataloader';\r\n\r\n// create a dataloader for the given model\r\nexport const createLoader = (Model: any) => {\r\n  const loader = new DataLoader(async (keys) => {\r\n    const data = await Model.find({ _id: { $in: keys } });\r\n    return keys.map((key) => data.filter(({ id }: any) => id === key));\r\n  });\r\n\r\n  return {\r\n    load: async (id: string) => loader.load(id),\r\n    loadMany: async (ids: string[]) => loader.loadMany(ids),\r\n    clear: (id: string) => loader.clear(id),\r\n    clearAll: () => loader.clearAll(),\r\n  };\r\n};\r\n"],"names":["createLoader","Model","loader","DataLoader","keys","data","find","_id","$in","map","key","filter","id","load","loadMany","ids","clear","clearAll"],"mappings":"AAAA,+FAAuB,KAAA,CAAY,2DAAZ,YAAY,EAAA,SAGtBA,YAAY,CAAG,AAACC,CAAU,EAAK,CAC1C,IAAMC,CAAM,CAAG,IAAIC,CAAU,QAAA,CAAC,MAAOC,CAAI,EAAK,CAC5C,IAAMC,CAAI,CAAG,MAAMJ,CAAK,CAACK,IAAI,CAAC,CAAEC,GAAG,CAAE,CAAEC,GAAG,CAAEJ,CAAI,CAAE,CAAE,CAAC,AAAC,AACtD,QAAOA,CAAI,CAACK,GAAG,CAAC,AAACC,CAAG,EAAKL,CAAI,CAACM,MAAM,CAAC,CAAC,CAAEC,EAAE,CAAFA,CAAE,CAAO,GAAKA,CAAE,GAAKF,CAAG,CAAC,CAAC,AAAC,CACpE,CAAC,AAAC,AAEH,OAAO,CACLG,IAAI,CAAE,MAAOD,CAAU,EAAKV,CAAM,CAACW,IAAI,CAACD,CAAE,CAAC,CAC3CE,QAAQ,CAAE,MAAOC,CAAa,EAAKb,CAAM,CAACY,QAAQ,CAACC,CAAG,CAAC,CACvDC,KAAK,CAAE,AAACJ,CAAU,EAAKV,CAAM,CAACc,KAAK,CAACJ,CAAE,CAAC,CACvCK,QAAQ,CAAE,IAAMf,CAAM,CAACe,QAAQ,EAAE,CAClC,AAAC,CACH,AAAC"}